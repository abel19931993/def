{% extends 'base.html'%} {% load static %} {% block content %}

        <div class="row">
            <div class="col-xl-12">
                <div class="card">
                    <div class="card-body">
                        <form action="{% url 'create_alices' %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row mb-4">
                                <label for="workspace_name" class="col-sm-3 col-form-label">Workspace Name:</label>
                                <div class="col-sm-3">
                                    <input type="text" name="workspace_name" id="workspace_name" value="{{ workspace_name }}" class="form-control" style="border: none; outline: none; background: transparent; font-weight: bold; font-size: 20px;" readonly>  
                                </div>
                            </div>
        
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row mb-4">
                                        <label for="database_type" class="col-sm-3 col-form-label">Selecte dataset:</label>
                                        <div class="col-sm-9">
                                            <select class="form-select" name="database_type" id="database_type" required>
                                                {% for db in supported_database %}
                                                    <option value="{{ db }}">{{ db }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
        
                                    <div class="row mb-4">
                                        <label class="col-sm-3 col-form-label">Upload Method</label>
                                        <div class="col-sm-9">
                                            <select class="form-select" id="upload_method">
                                                <option value="csv">Upload CSV</option>
                                                <option value="manual">Manual Entry</option>
                                            </select>
                                        </div>
                                    </div>
        
                                    <div id="csvUpload" class="row mb-4">
                                        <label for="formFile" class="col-sm-3 col-form-label">Choose CSV file</label>
                                        <div class="col-sm-9">
                                            <input class="form-control" type="file" id="csv_file" name="csv_file" accept=".csv" >
                                        </div>
                                    </div>
        
                                    <div id="manualEntry" class="row mb-4" style="display: none;">
                                        <div id="manualFieldsContainer" class="col-sm-9"></div>
                                    </div> 
                                </div>
        
                                <div class="col-sm-6">
                                    <label for="columns-select" class="col-sm-3 col-form-label offset-sm-3"><h4>Columns</h4></label>
                                    <div id="columnsContainer" class="col-sm-9 offset-sm-3">
                                        <!-- Column selection elements will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
        
                            <div class="row mb-4">
                                <div class="col-sm-9 offset-sm-3">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </div> 
                        </form>
                    </div>
                </div>
            </div>
        </div>
       <script> 
        document.getElementById('database_type').addEventListener('change', function() {
            const selectedDatabase = this.value;
            const columnsContainer = document.getElementById('columnsContainer');
        
            columnsContainer.innerHTML = ''; // Clear previous options
            fetch(`select_index/${selectedDatabase}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.columns && data.columns.length > 0) {
                        data.columns.forEach(column => {
                            const div = document.createElement('div');
                            div.className = 'form-check mb-3';
        
                            const label = document.createElement('label');
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.value = column;
                            checkbox.name = 'columns[]';
                            checkbox.className = 'form-check-input';
        
                            label.textContent = column;
                            label.className = 'form-check-label';
        
                            label.prepend(checkbox);
                            div.appendChild(label);
                            columnsContainer.appendChild(div);
                        });
                    } else {
                        console.error('No columns found in the response.');
                    }
                })
                .catch(error => console.error('Error fetching columns:', error));
        });
        
        // Toggle between CSV upload and manual entry
        document.getElementById('upload_method').addEventListener('change', function() {
            const csvUpload = document.getElementById('csvUpload');
            const manualEntry = document.getElementById('manualEntry');
        
            if (this.value === 'csv') {
                csvUpload.style.display = 'block';
                manualEntry.style.display = 'none';
            } else {
                csvUpload.style.display = 'none';
                manualEntry.style.display = 'block';
            }
        });
        
        // Add event listener to checkboxes in the columnsContainer
        document.getElementById('columnsContainer').addEventListener('change', function(event) {
            if (event.target.type === 'checkbox') {
                const container = document.getElementById('manualFieldsContainer');
                
                // If the checkbox is checked, create a text area
                if (event.target.checked) {
                    const label = document.createElement('label');
                    label.textContent = `${event.target.value}:`;
                    label.className = 'form-label';

                    const textArea = document.createElement('textarea');
                    textArea.name = `${event.target.value}`; // Unique name for each field
                    textArea.className = 'form-control mb-2';
                    textArea.placeholder = `Value for ${event.target.value}`;
                  
                    container.appendChild(label);
                    container.appendChild(textArea);
                } else {
                      // Remove the corresponding label and text area if unchecked
            const label = container.querySelector(`label:contains('Value for ${event.target.value}:')`);
            const textArea = container.querySelector(`textarea[name='manual_field_${event.target.value}']`);
            if (label) {
                container.removeChild(label);
            }
            if (textArea) {
                container.removeChild(textArea);
            }
                }
            }
        });
        
    </script>  

  {% endblock %}